import BackPropLayer.*

%% setup data
%training data
trainData = readmatrix('data/train.csv', 'Range', 'C2:ADF27456');
trainLabel = readmatrix('data/train.csv', 'Range', 'B2:B27456');
%testing data
testData = readmatrix('data/test.csv', 'Range', 'B2:ADE7173');
%get id labels
testID = readmatrix('data/test.csv', 'Range', 'A2:A7173');


%% setup network
network = BackpropLayer_Update(size(trainData, 1), 20, 10, 0.001);
network.outputLayer.transferFunc = "logsig";
network.hiddenLayer.transferFunc = "logsig";


%% do the training
epoch = 20;
for rounds = 1:epoch
    for i = 1:size(trainData, 2)
        % Get the ith input pattern and target patterns
        inputPattern = trainData(:, i);
        targetPattern = trainLabel(:, i);

        % Train the network with the current input and target pattern
        network = network.train(targetPattern', inputPattern, 1);
    end
end


%% classify test data
testClass = zeros(size(testID));
for i = size(testData)
    input = testData(:, i);
    output = compute
end


%% output
columnNames = {'id', 'label'};
fileName = 'backpropClassification.csv';
outputTable = [testID testClass];
%make csv
writematrix(outputTable, fileName);
writetable(array2table(outputTable, 'VariableNames',columnNames), fileName, 'WriteMode', 'append');
